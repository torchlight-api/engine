<?php

uses(\Torchlight\Engine\Tests\TorchlightTestCase::class);
use Torchlight\Engine\Tests\TestParser;

test('it parses test details', function () {
    $test = <<<'TEST'
:::request { "options": { "fileStyle": "html" } }
:::config { "language": "alpinejs", "theme":"material-theme-palenight" }
<div x-data="{ }" x-on:click="console.log('testing')"></div>

<p x-html="{
    prop: "Testing",
    init() {
        this.isPrettyNeatRight();
    },

    test() {
        console.log('testing');
    },

}"</p>
:::expectation
<pre><code data-theme='material-theme-palenight' data-lang='alpinejs' class='torchlight' style='background-color: #292D3E; --theme-selection-background: #00000080;'><!-- Syntax highlighted by torchlight.dev --><div class='line'><span style="color:#3A3F58; text-align: right; -webkit-user-select: none; user-select: none;" class="line-number"> 1</span><span style="color: #89DDFF;">&lt;</span><span style="color: #F07178;">div</span><span style="color: #89DDFF;"> </span><span style="color: #C792EA;">x-data</span><span style="color: #89DDFF;">=</span><span style="color: #89DDFF;">&quot;</span><span style="color: #89DDFF;">{ }</span><span style="color: #89DDFF;">&quot;</span><span style="color: #89DDFF;"> </span><span style="color: #C792EA;">x-on</span><span style="color: #89DDFF;">:</span><span style="color: #C792EA;">click</span><span style="color: #89DDFF;">=</span><span style="color: #89DDFF;">&quot;</span><span style="color: #A6ACCD;">console</span><span style="color: #89DDFF;">.</span><span style="color: #82AAFF;">log</span><span style="color: #89DDFF;">(</span><span style="color: #89DDFF;">&#39;</span><span style="color: #C3E88D;">testing</span><span style="color: #89DDFF;">&#39;</span><span style="color: #89DDFF;">)</span><span style="color: #89DDFF;">&quot;</span><span style="color: #89DDFF;">&gt;&lt;/</span><span style="color: #F07178;">div</span><span style="color: #89DDFF;">&gt;</span></div><div class='line'><span style="color:#3A3F58; text-align: right; -webkit-user-select: none; user-select: none;" class="line-number"> 2</span>&nbsp;</div><div class='line'><span style="color:#3A3F58; text-align: right; -webkit-user-select: none; user-select: none;" class="line-number"> 3</span><span style="color: #89DDFF;">&lt;</span><span style="color: #F07178;">p</span><span style="color: #89DDFF;"> </span><span style="color: #C792EA;">x-html</span><span style="color: #89DDFF;">=</span><span style="color: #89DDFF;">&quot;</span><span style="color: #89DDFF;">{</span></div><div class='line'><span style="color:#3A3F58; text-align: right; -webkit-user-select: none; user-select: none;" class="line-number"> 4</span><span style="color: #89DDFF;">    </span><span style="color: #F07178;">prop</span><span style="color: #89DDFF;">: </span><span style="color: #89DDFF;">&quot;</span><span style="color: #C3E88D;">Testing</span><span style="color: #89DDFF;">&quot;</span><span style="color: #89DDFF;">,</span></div><div class='line'><span style="color:#3A3F58; text-align: right; -webkit-user-select: none; user-select: none;" class="line-number"> 5</span><span style="color: #89DDFF;">    </span><span style="color: #F07178;">init</span><span style="color: #89DDFF;">() {</span></div><div class='line'><span style="color:#3A3F58; text-align: right; -webkit-user-select: none; user-select: none;" class="line-number"> 6</span><span style="color: #F07178;">        </span><span style="color: #89DDFF;">this.</span><span style="color: #82AAFF;">isPrettyNeatRight</span><span style="color: #F07178;">()</span><span style="color: #89DDFF;">;</span></div><div class='line'><span style="color:#3A3F58; text-align: right; -webkit-user-select: none; user-select: none;" class="line-number"> 7</span><span style="color: #F07178;">    </span><span style="color: #89DDFF;">},</span></div><div class='line'><span style="color:#3A3F58; text-align: right; -webkit-user-select: none; user-select: none;" class="line-number"> 8</span>&nbsp;</div><div class='line'><span style="color:#3A3F58; text-align: right; -webkit-user-select: none; user-select: none;" class="line-number"> 9</span><span style="color: #89DDFF;">    </span><span style="color: #F07178;">test</span><span style="color: #89DDFF;">() {</span></div><div class='line'><span style="color:#3A3F58; text-align: right; -webkit-user-select: none; user-select: none;" class="line-number">10</span><span style="color: #F07178;">        </span><span style="color: #A6ACCD;">console</span><span style="color: #89DDFF;">.</span><span style="color: #82AAFF;">log</span><span style="color: #F07178;">(</span><span style="color: #89DDFF;">&#39;</span><span style="color: #C3E88D;">testing</span><span style="color: #89DDFF;">&#39;</span><span style="color: #F07178;">)</span><span style="color: #89DDFF;">;</span></div><div class='line'><span style="color:#3A3F58; text-align: right; -webkit-user-select: none; user-select: none;" class="line-number">11</span><span style="color: #F07178;">    </span><span style="color: #89DDFF;">},</span></div><div class='line'><span style="color:#3A3F58; text-align: right; -webkit-user-select: none; user-select: none;" class="line-number">12</span>&nbsp;</div><div class='line'><span style="color:#3A3F58; text-align: right; -webkit-user-select: none; user-select: none;" class="line-number">13</span><span style="color: #89DDFF;">}</span><span style="color: #89DDFF;">&quot;</span><span style="color: #89DDFF;">&lt;/</span><span style="color: #C792EA;">p</span><span style="color: #89DDFF;">&gt;</span></div></code></pre>
:::end
<pre><code data-theme='material-theme-palenight' data-lang='alpinejs' class='torchlight' style='background-color: #292D3E; --theme-selection-background: #00000080;'><!-- Syntax highlighted by torchlight.dev --><div class='line'><span style="color:#3A3F58; text-align: right; -webkit-user-select: none; user-select: none;" class="line-number"> 1</span><span style="color: #89DDFF;">&lt;</span><span style="color: #F07178;">div</span><span style="color: #89DDFF;"> </span><span style="color: #C792EA;">x-data</span><span style="color: #89DDFF;">=</span><span style="color: #89DDFF;">&quot;</span><span style="color: #89DDFF;">{ }</span><span style="color: #89DDFF;">&quot;</span><span style="color: #89DDFF;"> </span><span style="color: #C792EA;">x-on</span><span style="color: #89DDFF;">:</span><span style="color: #C792EA;">click</span><span style="color: #89DDFF;">=</span><span style="color: #89DDFF;">&quot;</span><span style="color: #A6ACCD;">console</span><span style="color: #89DDFF;">.</span><span style="color: #82AAFF;">log</span><span style="color: #89DDFF;">(</span><span style="color: #89DDFF;">&#39;</span><span style="color: #C3E88D;">testing</span><span style="color: #89DDFF;">&#39;</span><span style="color: #89DDFF;">)</span><span style="color: #89DDFF;">&quot;</span><span style="color: #89DDFF;">&gt;&lt;/</span><span style="color: #F07178;">div</span><span style="color: #89DDFF;">&gt;</span></div><div class='line'><span style="color:#3A3F58; text-align: right; -webkit-user-select: none; user-select: none;" class="line-number"> 2</span>&nbsp;</div><div class='line'><span style="color:#3A3F58; text-align: right; -webkit-user-select: none; user-select: none;" class="line-number"> 3</span><span style="color: #89DDFF;">&lt;</span><span style="color: #F07178;">p</span><span style="color: #89DDFF;"> </span><span style="color: #C792EA;">x-html</span><span style="color: #89DDFF;">=</span><span style="color: #89DDFF;">&quot;</span><span style="color: #89DDFF;">{</span></div><div class='line'><span style="color:#3A3F58; text-align: right; -webkit-user-select: none; user-select: none;" class="line-number"> 4</span><span style="color: #89DDFF;">    </span><span style="color: #F07178;">prop</span><span style="color: #89DDFF;">: </span><span style="color: #89DDFF;">&quot;</span><span style="color: #C3E88D;">Testing</span><span style="color: #89DDFF;">&quot;</span><span style="color: #89DDFF;">,</span></div><div class='line'><span style="color:#3A3F58; text-align: right; -webkit-user-select: none; user-select: none;" class="line-number"> 5</span><span style="color: #89DDFF;">    </span><span style="color: #F07178;">init</span><span style="color: #89DDFF;">() {</span></div><div class='line'><span style="color:#3A3F58; text-align: right; -webkit-user-select: none; user-select: none;" class="line-number"> 6</span><span style="color: #F07178;">        </span><span style="color: #89DDFF;">this.</span><span style="color: #82AAFF;">isPrettyNeatRight</span><span style="color: #F07178;">()</span><span style="color: #89DDFF;">;</span></div><div class='line'><span style="color:#3A3F58; text-align: right; -webkit-user-select: none; user-select: none;" class="line-number"> 7</span><span style="color: #F07178;">    </span><span style="color: #89DDFF;">},</span></div><div class='line'><span style="color:#3A3F58; text-align: right; -webkit-user-select: none; user-select: none;" class="line-number"> 8</span>&nbsp;</div><div class='line'><span style="color:#3A3F58; text-align: right; -webkit-user-select: none; user-select: none;" class="line-number"> 9</span><span style="color: #89DDFF;">    </span><span style="color: #F07178;">test</span><span style="color: #89DDFF;">() {</span></div><div class='line'><span style="color:#3A3F58; text-align: right; -webkit-user-select: none; user-select: none;" class="line-number">10</span><span style="color: #F07178;">        </span><span style="color: #A6ACCD;">console</span><span style="color: #89DDFF;">.</span><span style="color: #82AAFF;">log</span><span style="color: #F07178;">(</span><span style="color: #89DDFF;">&#39;</span><span style="color: #C3E88D;">testing</span><span style="color: #89DDFF;">&#39;</span><span style="color: #F07178;">)</span><span style="color: #89DDFF;">;</span></div><div class='line'><span style="color:#3A3F58; text-align: right; -webkit-user-select: none; user-select: none;" class="line-number">11</span><span style="color: #F07178;">    </span><span style="color: #89DDFF;">},</span></div><div class='line'><span style="color:#3A3F58; text-align: right; -webkit-user-select: none; user-select: none;" class="line-number">12</span>&nbsp;</div><div class='line'><span style="color:#3A3F58; text-align: right; -webkit-user-select: none; user-select: none;" class="line-number">13</span><span style="color: #89DDFF;">}</span><span style="color: #89DDFF;">&quot;</span><span style="color: #89DDFF;">&lt;/</span><span style="color: #C792EA;">p</span><span style="color: #89DDFF;">&gt;</span></div></code></pre>
TEST;

    $testWithoutLastRun = <<<'TEST'
:::request { "options": { "fileStyle": "html" } }
:::config { "language": "alpinejs", "theme":"material-theme-palenight" }
<div x-data="{ }" x-on:click="console.log('testing')"></div>

<p x-html="{
    prop: "Testing",
    init() {
        this.isPrettyNeatRight();
    },

    test() {
        console.log('testing');
    },

}"</p>
:::expectation
<pre><code data-theme='material-theme-palenight' data-lang='alpinejs' class='torchlight' style='background-color: #292D3E; --theme-selection-background: #00000080;'><!-- Syntax highlighted by torchlight.dev --><div class='line'><span style="color:#3A3F58; text-align: right; -webkit-user-select: none; user-select: none;" class="line-number"> 1</span><span style="color: #89DDFF;">&lt;</span><span style="color: #F07178;">div</span><span style="color: #89DDFF;"> </span><span style="color: #C792EA;">x-data</span><span style="color: #89DDFF;">=</span><span style="color: #89DDFF;">&quot;</span><span style="color: #89DDFF;">{ }</span><span style="color: #89DDFF;">&quot;</span><span style="color: #89DDFF;"> </span><span style="color: #C792EA;">x-on</span><span style="color: #89DDFF;">:</span><span style="color: #C792EA;">click</span><span style="color: #89DDFF;">=</span><span style="color: #89DDFF;">&quot;</span><span style="color: #A6ACCD;">console</span><span style="color: #89DDFF;">.</span><span style="color: #82AAFF;">log</span><span style="color: #89DDFF;">(</span><span style="color: #89DDFF;">&#39;</span><span style="color: #C3E88D;">testing</span><span style="color: #89DDFF;">&#39;</span><span style="color: #89DDFF;">)</span><span style="color: #89DDFF;">&quot;</span><span style="color: #89DDFF;">&gt;&lt;/</span><span style="color: #F07178;">div</span><span style="color: #89DDFF;">&gt;</span></div><div class='line'><span style="color:#3A3F58; text-align: right; -webkit-user-select: none; user-select: none;" class="line-number"> 2</span>&nbsp;</div><div class='line'><span style="color:#3A3F58; text-align: right; -webkit-user-select: none; user-select: none;" class="line-number"> 3</span><span style="color: #89DDFF;">&lt;</span><span style="color: #F07178;">p</span><span style="color: #89DDFF;"> </span><span style="color: #C792EA;">x-html</span><span style="color: #89DDFF;">=</span><span style="color: #89DDFF;">&quot;</span><span style="color: #89DDFF;">{</span></div><div class='line'><span style="color:#3A3F58; text-align: right; -webkit-user-select: none; user-select: none;" class="line-number"> 4</span><span style="color: #89DDFF;">    </span><span style="color: #F07178;">prop</span><span style="color: #89DDFF;">: </span><span style="color: #89DDFF;">&quot;</span><span style="color: #C3E88D;">Testing</span><span style="color: #89DDFF;">&quot;</span><span style="color: #89DDFF;">,</span></div><div class='line'><span style="color:#3A3F58; text-align: right; -webkit-user-select: none; user-select: none;" class="line-number"> 5</span><span style="color: #89DDFF;">    </span><span style="color: #F07178;">init</span><span style="color: #89DDFF;">() {</span></div><div class='line'><span style="color:#3A3F58; text-align: right; -webkit-user-select: none; user-select: none;" class="line-number"> 6</span><span style="color: #F07178;">        </span><span style="color: #89DDFF;">this.</span><span style="color: #82AAFF;">isPrettyNeatRight</span><span style="color: #F07178;">()</span><span style="color: #89DDFF;">;</span></div><div class='line'><span style="color:#3A3F58; text-align: right; -webkit-user-select: none; user-select: none;" class="line-number"> 7</span><span style="color: #F07178;">    </span><span style="color: #89DDFF;">},</span></div><div class='line'><span style="color:#3A3F58; text-align: right; -webkit-user-select: none; user-select: none;" class="line-number"> 8</span>&nbsp;</div><div class='line'><span style="color:#3A3F58; text-align: right; -webkit-user-select: none; user-select: none;" class="line-number"> 9</span><span style="color: #89DDFF;">    </span><span style="color: #F07178;">test</span><span style="color: #89DDFF;">() {</span></div><div class='line'><span style="color:#3A3F58; text-align: right; -webkit-user-select: none; user-select: none;" class="line-number">10</span><span style="color: #F07178;">        </span><span style="color: #A6ACCD;">console</span><span style="color: #89DDFF;">.</span><span style="color: #82AAFF;">log</span><span style="color: #F07178;">(</span><span style="color: #89DDFF;">&#39;</span><span style="color: #C3E88D;">testing</span><span style="color: #89DDFF;">&#39;</span><span style="color: #F07178;">)</span><span style="color: #89DDFF;">;</span></div><div class='line'><span style="color:#3A3F58; text-align: right; -webkit-user-select: none; user-select: none;" class="line-number">11</span><span style="color: #F07178;">    </span><span style="color: #89DDFF;">},</span></div><div class='line'><span style="color:#3A3F58; text-align: right; -webkit-user-select: none; user-select: none;" class="line-number">12</span>&nbsp;</div><div class='line'><span style="color:#3A3F58; text-align: right; -webkit-user-select: none; user-select: none;" class="line-number">13</span><span style="color: #89DDFF;">}</span><span style="color: #89DDFF;">&quot;</span><span style="color: #89DDFF;">&lt;/</span><span style="color: #C792EA;">p</span><span style="color: #89DDFF;">&gt;</span></div></code></pre>
:::end
TEST;

    $expected = <<<'HTML'
<pre><code data-theme='material-theme-palenight' data-lang='alpinejs' class='torchlight' style='background-color: #292D3E; --theme-selection-background: #00000080;'><!-- Syntax highlighted by torchlight.dev --><div class='line'><span style="color:#3A3F58; text-align: right; -webkit-user-select: none; user-select: none;" class="line-number"> 1</span><span style="color: #89DDFF;">&lt;</span><span style="color: #F07178;">div</span><span style="color: #89DDFF;"> </span><span style="color: #C792EA;">x-data</span><span style="color: #89DDFF;">=</span><span style="color: #89DDFF;">&quot;</span><span style="color: #89DDFF;">{ }</span><span style="color: #89DDFF;">&quot;</span><span style="color: #89DDFF;"> </span><span style="color: #C792EA;">x-on</span><span style="color: #89DDFF;">:</span><span style="color: #C792EA;">click</span><span style="color: #89DDFF;">=</span><span style="color: #89DDFF;">&quot;</span><span style="color: #A6ACCD;">console</span><span style="color: #89DDFF;">.</span><span style="color: #82AAFF;">log</span><span style="color: #89DDFF;">(</span><span style="color: #89DDFF;">&#39;</span><span style="color: #C3E88D;">testing</span><span style="color: #89DDFF;">&#39;</span><span style="color: #89DDFF;">)</span><span style="color: #89DDFF;">&quot;</span><span style="color: #89DDFF;">&gt;&lt;/</span><span style="color: #F07178;">div</span><span style="color: #89DDFF;">&gt;</span></div><div class='line'><span style="color:#3A3F58; text-align: right; -webkit-user-select: none; user-select: none;" class="line-number"> 2</span>&nbsp;</div><div class='line'><span style="color:#3A3F58; text-align: right; -webkit-user-select: none; user-select: none;" class="line-number"> 3</span><span style="color: #89DDFF;">&lt;</span><span style="color: #F07178;">p</span><span style="color: #89DDFF;"> </span><span style="color: #C792EA;">x-html</span><span style="color: #89DDFF;">=</span><span style="color: #89DDFF;">&quot;</span><span style="color: #89DDFF;">{</span></div><div class='line'><span style="color:#3A3F58; text-align: right; -webkit-user-select: none; user-select: none;" class="line-number"> 4</span><span style="color: #89DDFF;">    </span><span style="color: #F07178;">prop</span><span style="color: #89DDFF;">: </span><span style="color: #89DDFF;">&quot;</span><span style="color: #C3E88D;">Testing</span><span style="color: #89DDFF;">&quot;</span><span style="color: #89DDFF;">,</span></div><div class='line'><span style="color:#3A3F58; text-align: right; -webkit-user-select: none; user-select: none;" class="line-number"> 5</span><span style="color: #89DDFF;">    </span><span style="color: #F07178;">init</span><span style="color: #89DDFF;">() {</span></div><div class='line'><span style="color:#3A3F58; text-align: right; -webkit-user-select: none; user-select: none;" class="line-number"> 6</span><span style="color: #F07178;">        </span><span style="color: #89DDFF;">this.</span><span style="color: #82AAFF;">isPrettyNeatRight</span><span style="color: #F07178;">()</span><span style="color: #89DDFF;">;</span></div><div class='line'><span style="color:#3A3F58; text-align: right; -webkit-user-select: none; user-select: none;" class="line-number"> 7</span><span style="color: #F07178;">    </span><span style="color: #89DDFF;">},</span></div><div class='line'><span style="color:#3A3F58; text-align: right; -webkit-user-select: none; user-select: none;" class="line-number"> 8</span>&nbsp;</div><div class='line'><span style="color:#3A3F58; text-align: right; -webkit-user-select: none; user-select: none;" class="line-number"> 9</span><span style="color: #89DDFF;">    </span><span style="color: #F07178;">test</span><span style="color: #89DDFF;">() {</span></div><div class='line'><span style="color:#3A3F58; text-align: right; -webkit-user-select: none; user-select: none;" class="line-number">10</span><span style="color: #F07178;">        </span><span style="color: #A6ACCD;">console</span><span style="color: #89DDFF;">.</span><span style="color: #82AAFF;">log</span><span style="color: #F07178;">(</span><span style="color: #89DDFF;">&#39;</span><span style="color: #C3E88D;">testing</span><span style="color: #89DDFF;">&#39;</span><span style="color: #F07178;">)</span><span style="color: #89DDFF;">;</span></div><div class='line'><span style="color:#3A3F58; text-align: right; -webkit-user-select: none; user-select: none;" class="line-number">11</span><span style="color: #F07178;">    </span><span style="color: #89DDFF;">},</span></div><div class='line'><span style="color:#3A3F58; text-align: right; -webkit-user-select: none; user-select: none;" class="line-number">12</span>&nbsp;</div><div class='line'><span style="color:#3A3F58; text-align: right; -webkit-user-select: none; user-select: none;" class="line-number">13</span><span style="color: #89DDFF;">}</span><span style="color: #89DDFF;">&quot;</span><span style="color: #89DDFF;">&lt;/</span><span style="color: #C792EA;">p</span><span style="color: #89DDFF;">&gt;</span></div></code></pre>
HTML;

    $code = <<<'HTML'
<div x-data="{ }" x-on:click="console.log('testing')"></div>

<p x-html="{
    prop: "Testing",
    init() {
        this.isPrettyNeatRight();
    },

    test() {
        console.log('testing');
    },

}"</p>
HTML;

    $parser = new TestParser;
    $parsedTest = $parser->parse($test);

    $this->assertSame([
        'language' => 'alpinejs',
        'theme' => 'material-theme-palenight',
    ], $parsedTest->config);
    $this->assertSame($testWithoutLastRun, $parsedTest->content);
    $this->assertSame([
        'options' => [
            'fileStyle' => 'html',
        ],
    ], $parsedTest->request);
    $this->assertSame($expected, $parsedTest->expect);
    $this->assertSame($code, $parsedTest->code);
});
